<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SABlog</title>
  <meta name="author" content="StoneArk">
  
  <meta name="description" content="方舟的技术博客">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="SABlog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="SABlog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-57166172-1', 'auto');
	ga('send', 'pageview');

</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">SABlog</a></h1>
  <h2><a href="/">StoneArk&#39;s Blog</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-06-24T07:41:21.000Z"><a href="/2015/06/24/updated-to-hexo-3-from-2/">Jun 24 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/06/24/updated-to-hexo-3-from-2/">Updated to Hexo 3 from 2</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我一直在用的静态博客框架 Hexo，在今年 3 月份大版本<a href="https://hexo.io/news/2015/03/05/hexo-3-0-released/" target="_blank" rel="external">升级到了 3.0 版</a>。一直没有从 2.x 升级到 3.x，今天升级并迁移到了最新的 3.1.1，了解了一下 3.x 的变化。<br>官方提供了<a href="https://github.com/hexojs/hexo/wiki/Migrating-from-2.x-to-3.0" target="_blank" rel="external">迁移文档</a>，升级过程很顺畅，安装 hexo-cli 时果然如文档所说 “error occurred”，把老版本的 hexo 先删掉就好。</p>
<p>有一个地方文档中并未提及，需要格外注意：除了安装 hexo-cli 之外的步骤，都应该在你的 blog 根目录下进行。这也反映出了新版本最大的变化：模块分离。</p>
<p>首先可以看到，新版本多了一个 <code>hexo-cli</code>，也就是 Hexo command line interface，这也是新版本中唯一需要安装到系统全局的模块。把 CLI 从主模块中分离，可以让 CLI 加载更快，同时能够允许你在不同的目录下维护着不同版本的 hexo blog。</p>
<p>而其他所有模块，包括 hexo, hexo-server, hexo-deployer, hexo-generator, hexo-renderer 等，都被安装在某一个 blog 的 node_modules 目录下，仅应用于这一个 blog。</p>
<p>模块分离有利有弊，但大多数情形下是利大于弊的。对于 hexo 来讲，带来最大的利就是，blog 目录下包含着所有需要的内容和程序，受系统环境的限制就能做到尽可能的小。而先前版本的 hexo，blog 目录中仅包含所有的内容，而并不包含程序 — 程序需要调用系统中安装的。设想一下，Alice 在 Bob 家度假，突然想用 Bob 的个人电脑写个博客（假设 Alice 没有带自己的笔记本）。Alice 平常用的是 2.x 版本的 hexo，并把 blog 目录同步到了 Dropbox。而 Bob 用的是 2.y 版本的 hexo，2.x 和 2.y 版本是不完全兼容的。于是，当 Alice 在自己的 blog 目录下执行 hexo 的命令时，可能会出现一些意想不到的错误 — 内容是 2.x 版本的，而程序是 2.y 版本的。</p>
<p>而如果它们都用了现在模块分离程度更高的版本，那么在 Alice 的 blog 目录中，就同时包含了 3.x 版本的内容和 3.x 版本的程序，虽然 Bob 的电脑上是 3.y 版本，但这并不影响什么 — 因为唯一需要依赖系统的是 hexo-cli，而这个 hexo-cli 只是一个 driver，具体的功能实现都将由 blog 目录中的程序接管。而由于这个 hexo-cli 功能非常简单，所以可以做到非常稳定，不同的版本基本上可以完全兼容。</p>
<p>这样的大版本更新也是有些副作用的，比如由于 hexo-deployer-git 模块也改变了，之前的 git 提交历史都没有了…</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-06-10T08:27:02.000Z"><a href="/2015/06/10/WWDC-2015/">Jun 10 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/06/10/WWDC-2015/">WWDC 2015</a></h1>
  

    </header>
    <div class="entry">
      
        <p>今年的 WWDC 没有什么让人兴奋的看点，没有硬件新品，没有突破性改变的软件新品，所带来的都是些稳定性的提高、细节的完善、功能的增强。但其实这也正是苹果目前最应该做的，步子大容易扯着蛋，这句话在 OS X Yosemite 和 iOS 8 上得到了验证。</p>
<h3 id="New_OS">New OS</h3><p>iOS 9，OS X EI Capitan, watch OS 2.</p>
<p>iOS 9，最让人没想到的是，它竟然还支持 iPhone 4s 和 iPad 2。按照以往的规则，iPhone 4s 和 iPad 2 今年应该被最新版的系统抛弃了。据说苹果对 iOS 9 从底层进行了大量的改造，大幅提高了系统的流畅度和稳定性，所以可以让老设备焕发第二春。可能是因为老设备运行 iOS 8 实在是太不堪入目，苹果想挽回一点儿面子？我迫不及待地把手中已经卡成翔的 iPhone 4s 升级到了 iOS 9 Developer Preview，用了两天，果断降回来了—频繁死机、卡顿，完全没法用，现阶段大家就不要尝试了。放张图给大家看看吧。<br><img src="http://7ktrjm.com1.z0.glb.clouddn.com/blogimg/ios9_devprev_scrshot.jpg" alt="iOS 9 Developer Preview"></p>
<p>iOS 9 在功能上最大的革新，是 iPad 上支持了多任务分屏，有 Slide Over、Split View、画中画三种模式。再就是 Siri 的搜索更加智能，会根据使用习惯给出建议。其他的都是些小变化了，比如地图支持公交、备忘录变成了个富文本编辑器、Passbook 变成了 Wallet。增加了两个新应用：News 和 Apple Music，估计在国内也没什么用。</p>
<p>对了，观感上的变化就是换了新的默认字体，英文新字体 San Francisco，中文新字体苹方，看上去还蛮不适应。</p>
<p>EI Capitan 没给我留下什么印象，还是好好改 bug 吧，把 bug 改好就挺好了…watch OS 2 也没啥说的，好好支持原生应用吧…</p>
<h3 id="New_tools">New tools</h3><p>Xcode 7, Swift 2, New developer program.</p>
<p>Xcode 7，竟然对在设备上调试不再做限制了，不再需要开发者身份就能直接将程序在任意设备上运行。这着实降低了开发者的入门门槛，但我比较担心这样会不会有空子可钻，毕竟 iOS 平台的应用安全就是靠着层层限制所保证的，一旦 Xcode 这种毫无限制的 Adhoc 被钻了空子，还是很棘手的。</p>
<p><img src="http://7ktrjm.com1.z0.glb.clouddn.com/blogimg/xcode7_run_on_device.jpg" alt="Xcode 7 run on device"></p>
<p>Swift 发布了 2.0 版，已经日臻成熟了。</p>
<p>一个令人兴奋的消息是，Developer Program 以后不再区分 iOS 和 Mac，之前购买的也将升级为新的 Apple Developer Program。以后只需要一个 99 美金就可以同时上架 iOS App Store 和 Mac App Store 了。</p>
<p><img src="http://stoneark.qiniudn.com/blogimg/new_apple_developer_program.jpg" alt="New Apple Developer Program"></p>
<h3 id="后记">后记</h3><p>今天看到篇文章，抨击之前 OS X 的中文默认字体，看着还有点意思：<a href="https://qdan.me/list/VXl0z-WpwObF_83e" target="_blank" rel="external">OS X / iOS 六年字体战争</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-05-30T01:26:28.000Z"><a href="/2015/05/30/Google-I-O-2015/">May 30 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/30/Google-I-O-2015/">Google I/O 2015</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Google I/O 2015 召开了，虽说今年的 Google I/O 没有像去年一样带来很多新东西，但这次大会不乏让人眼前一亮的内容。</p>
<p>首先是 Android M，终于把之前粗放的权限管理进行了重新设计，不再像之前那样只是在安装应用的时候通知你一下，而是借鉴了 iOS 更为科学的权限管理方式。Android 最大的问题之一就是权限，希望这次可以真正得到解决。Android M 原生支持了指纹识别，支持了 64 位架构，别的好像也没什么。</p>
<p>新推出的 Google Photos 看起来蛮不错，自然语言搜索貌似很强大。可以存储无限容量的照片，重要的是免费。当然有些人说之所以免费，是为了要搜集更大量的信息，以提高数据分析的能力。</p>
<p>还有个很有意思的东西，Cardboard，一个很接地气的 VR 装置，不得不佩服 Google 工程师们在 20% 时间里发挥出的聪明才智。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-05-29T07:05:11.000Z"><a href="/2015/05/29/gem-install-failed-cannot-load-such-file-openssl/">May 29 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/29/gem-install-failed-cannot-load-such-file-openssl/">“cannot load such file -- openssl” while “gem install”</a></h1>
  

    </header>
    <div class="entry">
      
        <p>工作用的 iMac 上一直没有安装 CocoaPods，因为曾经安装时遇到了一个错误，然后比较忙就搁置了，以至于搁置到了现在，今天终于把这遗留问题解决了。</p>
<p><a href="https://cocoapods.org/" target="_blank" rel="external">CocoaPods</a> 是应用于 Xcode 工程的第三方库依赖管理工具，可以非常方便地管理工程所需要引用的第三方库。由于它是用 ruby 开发的，所以在 Mac 上安装它是一个非常简单的事情：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install cocoapods</span><br></pre></td></tr></table></figure>
<p>但是当我执行这个命令时，却得到了错误的反馈：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR:  Loading command: install (LoadError)&#10;&#9;cannot load such file -- openssl&#10;ERROR:  While executing gem ... (NoMethodError)&#10;    undefined method `invoke_with_build_args&#39; for nil:NilClass</span><br></pre></td></tr></table></figure>
<p>其实此时不只是安装 CocoaPods，安装其他大部分的 gem 都会是这个结局，因为找不到 openssl，无法建立加密连接，也就无法开始下载。</p>
<p>系统中是有 openssl 的，而且 openssl 可以正常工作，只是 ruby 找不到它。至于为什么突然找不到了，那就不太清楚了，推测可能是更新 OS X 时引发的问题吧。试了很多方法，各种不奏效，最后通过以下的方法解决了。大体思路是用 rvm 重新安装 openssl，然后重新安装 ruby，并指定 openssl 的路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm pkg install openssl&#10;rvm reinstall ruby-2.1 --with-openssl-dir=$rvm_path/usr</span><br></pre></td></tr></table></figure>
<p>都安装完成之后，就可以正常 <code>gem install</code> 啦。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-05-22T08:40:57.000Z"><a href="/2015/05/22/baidumap-memory-not-be-freed/">May 22 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/22/baidumap-memory-not-be-freed/">百度地图 (iOS SDK) 内存不回收</a></h1>
  

    </header>
    <div class="entry">
      
        <p>情景：有一个列表，点击列表中的某一条目后，进入详情页面，详情页面是一个地图。</p>
<p>环境：百度地图 iOS SDK v2.7.0</p>
<p>测试人员发现，从列表反复多次进入详情（push, pop, push, pop, …），五六次后程序崩溃。查看日志，发现是 Received Memory Warning。</p>
<p>通过 Xcode 的 Debug Navigator 监测，发现每进入一次地图页面，内存即增加占用约 20MB，但返回后内存并不回收。于是内存占用逐渐增多，直至被 kill。</p>
<p>继续监测程序的运行，发现地图页面在 pop 时，dealloc 方法并没有被执行，所以整个详情页面，包括地图，一直没有从内存中被 dealloc。</p>
<p>最终发现，除了百度地图的 mapView，在 self.view 上还有另一个 subview，而正因为这个 subview 没有 removeFromSuperView，导致了内存一直不能被回收。</p>
<p>含有百度地图的 viewWillDisappear 里一般是这样写的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillDisappear:(BOOL)animated &#123;&#10;    [_bmkMapView viewWillDisappear];&#10;    [_bmkMapView setDelegate:nil];&#10;    [super viewWillDisappear:animated];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>但此时需要这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillDisappear:(BOOL)animated &#123;&#10;    [_bmkMapView viewWillDisappear];&#10;    [_bmkMapView setDelegate:nil];&#10;    for (UIView *view in [self.view subviews]) &#123;&#10;        [view removeFromSuperview];&#10;    &#125;&#10;    [super viewWillDisappear:animated];&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>另外，还有一些其他的情形也可能造成此类问题，基本原理是一致的，都是因为还有某个对象被引用着。内存的管理还是得加小心啊。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-05-19T08:29:12.000Z"><a href="/2015/05/19/pop-then-push-immediately-with-uinavigationcontroller-in-ios8/">May 19 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/05/19/pop-then-push-immediately-with-uinavigationcontroller-in-ios8/">Pop then push immediately with UINavigationController in iOS 8</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在某些业务场景下，需要将一个 ViewController 从 NavigationController 里 pop 后，立即 push 进另一个 ViewController。在 iOS8 之前这不是什么问题，用以下代码即可轻松实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[navigationController popViewControllerAnimated:NO];&#10;[navigationController pushViewController:newViewController animated:YES];</span><br></pre></td></tr></table></figure>
<p>但在 iOS8 上这样无法实现，pop 后不会 push 另一个 ViewController。可以用以下方法实现，思路是直接修改 navigationController 里栈的数据（暂时没有找到其他更好的方法）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSMutableArray *viewControllersInStack = [NSMutableArray arrayWithArray:navigationController.viewControllers];&#10;[viewControllersInStack removeLastObject];&#10;[viewControllersInStack addObject:newViewController];&#10;[navController setViewControllers:viewControllersInStack animated:YES];</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-02-11T08:52:49.000Z"><a href="/2015/02/11/branching-model-summary/">Feb 11 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/02/11/branching-model-summary/">分支策略总结</a></h1>
  

    </header>
    <div class="entry">
      
        <p>前几日在发布新版本时，发现 SVN 的分支策略有问题，然后读了 <a href="../../../../2015/02/03/common-branching-patterns-translation-part-one">SVN 的常见分支模式</a>，依照文章里的模式改变了分支策略，貌似解决了问题。但我对之前用的策略还是念念不忘，经过调查和思考，得出结论：之前用的策略也没有问题，and what’s more，那是 Git 更常用的分支模式，但更适合于开发流程规范、并严格遵循的项目。</p>
<p>在 Git 分支模型的阐述上，Vincent Driessen 的 <a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a> 是一篇很多人认为不错的文章，译文也已经有好几篇了：<a href="http://www.oschina.net/translate/a-successful-git-branching-model">介绍一个成功的 Git 分支模型</a>，<a href="http://jiongks.name/blog/a-successful-git-branching-model/">Git 分支的最佳实践</a>，<a href="http://www.juvenxu.com/2010/11/28/a-successful-git-branching-model/">一个成功的Git分支模型</a>。</p>
<p>个人认为，这篇文章阐述的分支模型是非常不错的，但遣词造句上实在有些繁琐，读起来很费劲，不过绝对值得一读。</p>
<p>下面是我对分支策略的总结。</p>
<h3 id="Subversion_和_Git">Subversion 和 Git</h3><ol>
<li>Git 是分布式的版本控制系统，所有人都拥有一个仓库，而不仅仅是一个 working copy。但依然要有一个远端的中心，称为 origin。相对的，Subversion 是集中式的版本控制系统，仓库只在远端。</li>
<li>Subversion 的三大部分是 trunk、branches、tags，即主干、分支、标记。相对的，Git 没有 trunk 的概念，主干可以认为是 master 分支，也是分支之一。</li>
<li>Git 的分支才是真正意义上的分支。相对的，Subversion 在本质上不存在分支，所谓分支只是目录的拷贝。</li>
<li>Git 在分支与合并方面是简单易行的。相对的，Subversion 的分支与合并总是让人恐惧。</li>
</ol>
<h3 id="分支模式一（Git_风格）">分支模式一（Git 风格）</h3><ol>
<li>长期分支有主分支（master）和开发分支（develop），短期分支有特性分支（feature）、预发布分支（release）、补丁分支（hotfix）。</li>
<li>master 分支，始终 <strong>仅</strong> 保存每次发布的版本，HEAD 则指向当前发布的最新版本。日常的开发工作不直接在主分支进行。</li>
<li>develop 分支，其中为 <strong>下一次</strong> 要发布的版本（而不包含下次的下次发布应包含的功能）。</li>
<li>feature 分支，开发某项新特性时使用。这项特性可能在下一次发布时加入软件，也可能在下次的下次发布时才加入软件。也有可能是实验性质的特性，最终可能得以加入软件，也可能效果不好直接抛弃。它应从 develop 分支出，开发完毕后合并回 develop 或直接丢弃。注意并回的时机，是要在 <strong>下次发布的版本</strong> 中引入这个特性时，而 <strong>不是</strong> 下次的下次发布时。合并完毕后，应将这个 feature 分支删除。</li>
<li>release 分支，在某一版本准备发布时使用。在 develop 分支已经可以进入发布前的测试时，从 develop 分支出，命名为 <code>release-1.0</code>。测试过程中的 bug 修复，应提交到该分支。测试结束可以发布时，将该分支合并回 master 分支和 develop 分支，并给 master 分支打一个 tag（如 1.0）。然后，将这个 release 分支删除。需要注意的是，合并回 master，是因为这将成为一个新的发布版本；合并回 develop，是为了将 release 分支中对 bug 的修复也合并回 develop 分支，更好的方式是随着测试而不断地将 bug 修复合并回 develop，避免最后才一次性合并。</li>
<li>hotfix 分支，在线上版本出现 bug 需要紧急修复时使用。在 master 分支出，命名为 <code>hotfix-1.0.1</code>。在完成修复代码并通过测试后，合并回 master 和 develop，并对 master 打一个 tag（如 1.0.1）。然后，将这个 hotfix 分支删除。</li>
</ol>
<h3 id="分支模式二（Subversion_风格）">分支模式二（Subversion 风格）</h3><ol>
<li>trunk 主干，日常的开发工作直接在 trunk 进行。</li>
<li>长期分支有发布分支（release），短期分支有特性分支（feature）。</li>
<li>release 分支，在某一版本准备发布时使用。在 trunk 中的开发已经可以进入发布前的测试时，从 trunk 分支出，命名为 <code>release-1.0</code>。测试过程中的 bug 修复，应提交到该分支。测试结束可以发布时，将该分支合并回 trunk，并给该 release 分支打一个 tag（如 1.0）。注意，这个 release 分支将 <strong>永久保留</strong> ，之后的 hotfix 也将在此分支进行。</li>
<li>feature 分支，开发某项新特性时使用。这与分支模式一里的 feature 分支完全相同，唯一不同的是，它从 trunk 分支出，并最终合并回 trunk 或直接丢弃，最后被删除。</li>
</ol>
<h3 id="Then_which_one?">Then which one?</h3>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2015/02/11/branching-model-summary/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-02-05T05:40:36.000Z"><a href="/2015/02/05/noip-2014-rps-solution-in-python/">Feb 5 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/02/05/noip-2014-rps-solution-in-python/">生活大爆炸版石头剪刀布</a></h1>
  

    </header>
    <div class="entry">
      
        <p>前几日偶然间发现，14年母校的信息学成绩十分了得，<a href="http://www.tadyz.com/news/show.aspx?id=4507&amp;cid=52" target="_blank" rel="external">在 NOI 2014 中获得了一枚铜牌</a>，<a href="http://www.tadyz.com/news/show.aspx?id=4831&amp;cid=52" target="_blank" rel="external">在 NOIP 2014 中获得了五个一等、两个二等</a>，真是后生可畏，一代更比一代强啊。</p>
<p>好久好久没有做过算法题了。从 NOIP 2003 到 NOIP 2008，从没进复赛，到以总分第二获得一等奖，再到后面几年不堪的表现，NOIP 陪伴了我的整个中学。今天找来 NOIP 2014 的复赛题看了看，发现第一题挺水的，于是做了做。可惜的是 free pascal 在 Yosemite 上竟无法安装，所以决定用 python 来写，顺便再熟悉一下 python。</p>
<p>题目可<a href="http://wenku.baidu.com/link?url=GxvKf1aphFBGKdzO8WLmF6qC5q7VrGx_I3hAH8PDFEzkFOBoiG1e3dN6qLRyR5VZ6DxpZgN67G85VuaU4JVCv3ErJ92Yefr3l6iOfqjQLh_" target="_blank" rel="external">在这儿查看</a>或自行查找，是 NOIP 2014 提高组复赛 Day1 的第一题：生活大爆炸版石头剪刀布。</p>
<p>题目不难，数据规模也不大，把整个过程模拟一下就好了。唯一值得说的是，将题目中的胜负关系表格补全后形成一个二维数组，就能很方便地在这个数组中查询到每一轮出拳的结果。</p>
<figure class="highlight python"><figcaption><span>rps.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">filein = open(<span class="string">"rps.in"</span>,<span class="string">"r"</span>)</span><br><span class="line">arrInput = filein.readline().split()</span><br><span class="line">n = int(arrInput[<span class="number">0</span>])</span><br><span class="line">na = int(arrInput[<span class="number">1</span>])</span><br><span class="line">nb = int(arrInput[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">arrInput = filein.readline().split()</span><br><span class="line">arrA = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> arrInput]</span><br><span class="line"></span><br><span class="line">arrInput = filein.readline().split()</span><br><span class="line">arrB = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> arrInput]</span><br><span class="line">filein.close()</span><br><span class="line"></span><br><span class="line">resultTable = [[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>],[<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]]</span><br><span class="line">scoreA = <span class="number">0</span></span><br><span class="line">scoreB = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,n):</span><br><span class="line">    solutionA = arrA[i % na]</span><br><span class="line">    solutionB = arrB[i % nb]</span><br><span class="line">    scoreA += resultTable[solutionA][solutionB]</span><br><span class="line">    scoreB += resultTable[solutionB][solutionA]</span><br><span class="line"></span><br><span class="line">fileout = open(<span class="string">"rps.out"</span>,<span class="string">"w"</span>)</span><br><span class="line">strScore = str(scoreA) + <span class="string">' '</span> + str(scoreB) + <span class="string">'\n'</span></span><br><span class="line">fileout.write(strScore)</span><br><span class="line">fileout.close()</span><br></pre></td></tr></table></figure>
<p>程序很简单。刚开始是读取数据：<code>n</code>、<code>na</code>、<code>nb</code> 的含义如题，<code>arrA</code> 和 <code>arrB</code> 保存 A 和 B 的策略。<code>resultTable</code> 是前面说过的胜负关系数组，resultTable[甲,乙] 表示甲对乙的得分。for 循环中是对 n 轮出拳进行模拟：用当前的轮数与 A 或 B 的循环节长度取模，就能得到本轮 A 和 B 的策略，用这两个策略去 resultTable 中查询，就能得到 A 和 B 本轮的得分，保存于 <code>scoreA</code> 和 <code>scoreB</code>。最后输出结果。</p>
<p>对 python 了解不多，如果有写的不妥之处，欢迎拍砖。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-02-03T03:26:44.000Z"><a href="/2015/02/03/common-branching-patterns-translation-part-one/">Feb 3 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/02/03/common-branching-patterns-translation-part-one/">常见分支模式（译）</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="前言">前言</h2><p>今天在将分支合并回 trunk 的时候，发现之前采用的分支模式不太合适，于是去查阅了 SVN 的用户手册 <a href="http://svnbook.red-bean.com/en/1.7/svn-book.html#svn.branchmerge.commonpatterns" target="_blank" rel="external">Version Control With Subversion - Common Branching Patterns</a>，对分支管理有了更全面的认识。</p>
<p>版权声明：本文翻译自 Ben Collins-Sussman, Brian W. Fitzpatrick, C. Michael Pilato 撰写的 <a href="http://svnbook.red-bean.com/en/1.7/svn-book.html" target="_blank" rel="external">Version Control With Subversion</a>。这是一本自由书籍，遵循 Creative Common Attribution License，<a href="http://svnbook.red-bean.com/en/1.7/svn.copyright.html" target="_blank" rel="external">这里是它的版权协议</a>，本译文同样遵循此协议。</p>
<h2 id="译文">译文</h2><p>使用分支 (branch) 和合并 (merge) 的方式有很多，本节介绍了其中最常用的几种。</p>
<p>版本控制是在软件开发中最常用到的概念，所以我们来看一下被开发团队们最常用到的分支/合并模式。如果你在软件开发中并没有用 Subversion 来做版本控制，直接略过这一节就好。如果你是第一次在软件开发中使用版本控制，那请格外注意，因为这些模式通常已被认为是最佳实践。这些模式并不是 Subversion 才独有的，而是适用于任意的版本控制系统。我们以 Subversion 来描述这些模式，让它更容易理解。</p>
<h3 id="用于发布的分支_(Release_分支)">用于发布的分支 (Release 分支)</h3><p>大多数软件都遵循这样的生命周期：编码，测试，发布，如此循环往复。在这个过程中存在两个问题。第一，在质量保证团队测试稳定版本的同时，开发团队依然需要继续开发新的功能。当软件在接受测试时，新的开发工作不能停顿。第二，开发团队大多都需要支持较老的、已经发布出去的版本。如果在较老的代码中发现了 bug，这个 bug 很有可能也存在于已经释出的版本中。客户想要马上修复它，而不用等待下一个大版本发布时才能解决。</p>
<p>这两个问题借助版本控制可以解决。以下是经典的过程：</p>
<ol>
<li><em>开发者将所有新工作提交到 trunk 上。</em> 每日的改变都被提交到 <em>/trunk</em> ：包括新功能、bug 修复等。</li>
<li><em>复制 trunk 到一个 “release” 分支。</em> 当团队认为软件可以发布的时候（比如，发布 1.0 版本），<em>/trunk</em> 会被拷贝到 <em>/branches/1.0</em> 。</li>
<li><em>团队继续并行工作。</em> 一个团队开始对 release 分支进行严格的测试，同时，另一个团队在 <em>/trunk</em> 继续新的工作（比如，开发 2.0 版本）。无论哪一个团队发现了 bug，在必要的时候，对于这个 bug 的修复都可以移植 (ported) 到另一个团队。这个过程在某个时间点会停止，然后这个分支将会被“冻结”，以供发布前进行最终测试。</li>
<li><em>标记这个分支 (tagged) 并发布。</em> 当测试结束后，为 <em>/branches/1.0</em> 创建一个标记到 <em>/tags/1.0.0</em> ，作为一个引用快照。这个 tag 中的版本将会被打包并发布给用户。</li>
<li><em>这个分支随着时间的推移进行适当的维护。</em> 2.0 版本的开发工作在 <em>/trunk</em> 中继续，修复的 bug 也陆续从 <em>/trunk</em> 中移植到 <em>/branches/1.0</em> 。当修复的 bug 数量累积到足够多的时候，管理层可能决定发布 1.0.1 版本，此时应把 <em>/branches/1.0</em> 创建标记到 <em>/tags/1.0.1</em> ，这个 1.0.1 的 tag 会被打包发布。</li>
</ol>
<p>这整个过程将随着软件的成熟而不断反复进行：当 2.0 的工作完成后，一个新的名为 2.0 的 release 分支会被创建、测试、标记，最终发布。几年后，整个 repository 将会是好多个处于“维护”模式的 release 分支，和好多个标志着最终发布给用户的 tag。</p>
<h3 id="用于新特性的分支_(Feature_分支)">用于新特性的分支 (Feature 分支)</h3><p><em>用于新特性的分支 (feature branch)</em> 是在这一章最合适的例子（当 Sally 继续在 <em>/trunk</em> 工作时，你需要开发一个新功能）【译者注：请参见原文在本节之前创设的情境】。这时一种临时的分支，用于进行一些复杂的修改，而不会影响到 <em>/trunk</em> 的稳定。不像 release 分支（需要永久支持），feature 分支的生命历程是：创建，使用它来进行新特性的开发，合并回 trunk，然后被永久删除。它们的作用是有限的。</p>
<p>另外，什么时候需要创建 feature 分支是不一定的，与不同工程的不同情况有关。有些工程从来不使用 feature 分支：所有人都可以自由地向 <em>/trunk</em> 提交。这种系统的好处是非常简单－－不需要有人懂得有关分支和合并的知识。缺点是 trunk 的代码经常是不稳定的甚至是不可用的。而有些工程将分支用到了极致：所有的修改都 <em>从不</em> 直接提交到 trunk。即使是最微不足道的修改，也需要专门创建一个短命的分支，仔细审查，然后合并回 trunk。然后这个短命的分支就被删除了。这样可以保证在任何时间 trunk 都绝对稳定并可用，但是导致了大量的流程开销。</p>
<p>大多数工程采用了折中的方式。这种方式坚持 <em>trunk</em> 在任何时间都可以正常编译并通过回归测试。只有当某次修改包含大量提交，可能造成不稳定时，才需要创建 feature 分支。一个好的判断准则是：如果一个功能需要开发者独立工作好几天，然后一次性提交大量的修改（因为要保证 <em>trunk</em> 的稳定，所以要一次性），那这样的修改是不是大到需要进行代码审查了？如果对这个问题的回答是肯定的，那这些修改就应该在一个 feature 分支中进行。这样，开发者就能以递增的方式向 feature 分支中多次提交，而不必担心影响稳定，其他人也可以很容易地审阅到分支中这些代码的变化情况。</p>
<p>最后还有一个问题，如何在工作的进程中保持 feature 分支和 trunk 的同步。正如我们之前所说，在一个分支上工作数周甚至数月是有很大风险的；trunk 上的修改越来越多，与 feature 分支中对应代码行的差距越来越大，从 branch 合并回 trunk 可能会变得噩梦一般。</p>
<p>可以通过时常将 trunk 的变更合并到 branch 来避免这种状况【译者注：合并不是单向的，可以从 branch 合并回 trunk，也可以从 trunk 合并到 branch，后者也被称为“同步”】。制定一个原则：每周一次，将上周 trunk 上的变更合并到 branch 中。</p>
<p>在某个时间点，你会准备将“已同步”的 feature 分支合并回 trunk 中。要做这件事，首先要进行最后一次同步，将 trunk 最新的修改同步到 feature 分支中。完成后，最新的 branch 和 trunk 除了你在 branch 上的修改之外，将是完全一致的。然后就可以通过 <code>reintegrate</code> 选项将分支合并回去了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd trunk-working-copy&#10;&#10;$ svn update&#10;At revision 1910.&#10;&#10;$ svn merge --reintegrate http://svn.example.com/repos/calc/branches/mybranch&#10;--- Merging differences between repository URLs into &#39;.&#39;:&#10;U    real.c&#10;U    integer.c&#10;A    newdirectory&#10;A    newdirectory/newfile&#10; U   .&#10;&#8230;</span><br></pre></td></tr></table></figure>
<p>另外一种理解这种模式的方法是，每周从 trunk 向 branch 的同步可以看作是在 working copy 中执行了 <em>svn update</em> ，最后的合并操作可以看作是在 working copy 中执行了 <em>svn commit</em> 。既然这样，working copy 不就可以认为是一种非常浅的、私有的分支吗？它就是一种特别的分支，每次只有很少的变更。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-01-26T09:21:36.000Z"><a href="/2015/01/26/remove-empty-folder-in-launchpad/">Jan 26 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/01/26/remove-empty-folder-in-launchpad/">删掉 Launchpad 里的空白文件夹</a></h1>
  

    </header>
    <div class="entry">
      
        <p>Yosemite 的 bug 是真不少，昨晚又发现了一个，Launchpad 里的空白文件夹怎么删都删不掉！（Yosemite 10.10.1）</p>
<p>昨晚手一滑，在 Launchpad 里把一个应用的图标拖到另一个上面了，自然而然地形成了一个文件夹。我随即把他俩都从文件夹里移出来，文件夹自动消失了，看起来没啥问题。等等！重启一下，问题来了，那个文件夹又出现了，而且是空白的，按住 Option 键也没有叉号。如果把一个应用图标再拖进去，然后再拖出来，那个文件夹会再次消失，不过重启之后…抓狂啊！</p>
<p><img src="http://stoneark.qiniudn.com/blogimg/empty_folder_in_launchpad.png" alt="Empty folder in Launchpad"></p>
<p>找到如下方法，在终端中：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ defaults write com.apple.dock ResetLaunchPad -bool true&#10;$ killall Dock</span><br></pre></td></tr></table></figure>
<p>如果无效，可以尝试重新启动一下 Mac。</p>
<p>另外，网络上还流传着另一种方法，也可以尝试一下，看上去原理都是重置 Dock 的数据：</p>
<pre><code>把 ~/<span class="keyword">Library</span>/Dock 目录中的所有文件移入废纸篓，重新启动即可。
</code></pre>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:blog.stoneark.org">
  </form>
</div>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Net/" style="font-size: 10px;">.Net</a> <a href="/tags/Algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/Apple/" style="font-size: 10px;">Apple</a> <a href="/tags/BaiduMap/" style="font-size: 10px;">BaiduMap</a> <a href="/tags/Bluetooth/" style="font-size: 10px;">Bluetooth</a> <a href="/tags/CoreLocation/" style="font-size: 10px;">CoreLocation</a> <a href="/tags/DDOS/" style="font-size: 10px;">DDOS</a> <a href="/tags/Debug/" style="font-size: 10px;">Debug</a> <a href="/tags/Document/" style="font-size: 10px;">Document</a> <a href="/tags/Evernote/" style="font-size: 10px;">Evernote</a> <a href="/tags/Google/" style="font-size: 10px;">Google</a> <a href="/tags/History/" style="font-size: 10px;">History</a> <a href="/tags/Launchpad/" style="font-size: 10px;">Launchpad</a> <a href="/tags/Mac/" style="font-size: 13.33px;">Mac</a> <a href="/tags/Mac-OS-X/" style="font-size: 16.67px;">Mac OS X</a> <a href="/tags/Memory/" style="font-size: 10px;">Memory</a> <a href="/tags/Monitor/" style="font-size: 10px;">Monitor</a> <a href="/tags/NOIP/" style="font-size: 10px;">NOIP</a> <a href="/tags/Objective-C/" style="font-size: 10px;">Objective-C</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/tags/Server/" style="font-size: 10px;">Server</a> <a href="/tags/TableView/" style="font-size: 10px;">TableView</a> <a href="/tags/Translation/" style="font-size: 13.33px;">Translation</a> <a href="/tags/UI/" style="font-size: 13.33px;">UI</a> <a href="/tags/UIFont/" style="font-size: 10px;">UIFont</a> <a href="/tags/UINavigationController/" style="font-size: 10px;">UINavigationController</a> <a href="/tags/View-Hierarchy/" style="font-size: 10px;">View Hierarchy</a> <a href="/tags/Virus/" style="font-size: 10px;">Virus</a> <a href="/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/tags/WWDC/" style="font-size: 10px;">WWDC</a> <a href="/tags/Windows-server/" style="font-size: 10px;">Windows server</a> <a href="/tags/WireLurker/" style="font-size: 10px;">WireLurker</a> <a href="/tags/Xcode/" style="font-size: 10px;">Xcode</a> <a href="/tags/Xcode6/" style="font-size: 16.67px;">Xcode6</a> <a href="/tags/computer/" style="font-size: 10px;">computer</a> <a href="/tags/font/" style="font-size: 10px;">font</a> <a href="/tags/gem/" style="font-size: 10px;">gem</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/gmail/" style="font-size: 10px;">gmail</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/hexo/" style="font-size: 16.67px;">hexo</a> <a href="/tags/iBeacon/" style="font-size: 10px;">iBeacon</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/iOS8/" style="font-size: 16.67px;">iOS8</a> <a href="/tags/iTunes-Connect/" style="font-size: 13.33px;">iTunes Connect</a> <a href="/tags/ios/" style="font-size: 10px;">ios</a> <a href="/tags/jailbreak/" style="font-size: 10px;">jailbreak</a> <a href="/tags/lpk-dll/" style="font-size: 10px;">lpk.dll</a> <a href="/tags/openssl/" style="font-size: 10px;">openssl</a> <a href="/tags/oracle/" style="font-size: 13.33px;">oracle</a> <a href="/tags/program/" style="font-size: 10px;">program</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/svn/" style="font-size: 10px;">svn</a> <a href="/tags/谜题/" style="font-size: 10px;">谜题</a> <a href="/tags/递归/" style="font-size: 10px;">递归</a>
  </div>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/06/24/updated-to-hexo-3-from-2/">Updated to Hexo 3 from 2</a>
      </li>
    
      <li>
        <a href="/2015/06/10/WWDC-2015/">WWDC 2015</a>
      </li>
    
      <li>
        <a href="/2015/05/30/Google-I-O-2015/">Google I/O 2015</a>
      </li>
    
      <li>
        <a href="/2015/05/29/gem-install-failed-cannot-load-such-file-openssl/">“cannot load such file -- openssl” while “gem install”</a>
      </li>
    
      <li>
        <a href="/2015/05/22/baidumap-memory-not-be-freed/">百度地图 (iOS SDK) 内存不回收</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 StoneArk
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'stoneark';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>